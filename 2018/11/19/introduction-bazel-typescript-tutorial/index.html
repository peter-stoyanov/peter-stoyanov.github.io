<!doctype html>
<html ⚡ lang="en-us">
  <head>
    <meta charset="utf-8" />
    <script async src="https://cdn.ampproject.org/v0.js"></script>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-sidebar" src="https://cdn.ampproject.org/v0/amp-sidebar-0.1.js"></script>

    
    

    
    <title>Building TypeScript Projects with Bazel</title>

    
    



  
  
  <meta name="author" content="minko_gechev" />
  <meta name="description" content="In this blog post, we&amp;rsquo;ll make a brief introduction to what Bazel is and how we can build our TypeScript projects with it. If you&amp;rsquo;re already familiar with the problems that Bazel solves, feel free to skip to the section &amp;ldquo;Building TypeScript with Bazel.&amp;rdquo; You can find the example from this blog post in my GitHub account.
Inside Google&amp;rsquo;s CI Google manages a massive amount of source code. There are dependencies between the individual projects, for example, the user interface of Google Cloud depends on Angular &amp;amp; Angular Material, Angular Material depends on Angular, which depends on TypeScript.">

  
  
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@gohugoio" />
    <meta name="twitter:title" content="Building TypeScript Projects with Bazel" />
    <meta name="twitter:description" content="In this blog post, we&amp;rsquo;ll make a brief introduction to what Bazel is and how we can build our TypeScript projects with it. If you&amp;rsquo;re already familiar with the problems that Bazel solves, feel free to skip to the section &amp;ldquo;Building TypeScript with Bazel.&amp;rdquo; You can find the example from this blog post in my GitHub account.
Inside Google&amp;rsquo;s CI Google manages a massive amount of source code. There are dependencies between the individual projects, for example, the user interface of Google Cloud depends on Angular &amp;amp; Angular Material, Angular Material depends on Angular, which depends on TypeScript." />
    <meta name="twitter:image" content="https://peter-stoyanov.github.io/img/avatar.jpg" />
  




<meta name="generator" content="Hugo 0.47.1">


<link rel="canonical" href="https://peter-stoyanov.github.io/2018/11/19/introduction-bazel-typescript-tutorial/">
<link rel="alternative" href="https://peter-stoyanov.github.io/index.xml" title="coreComponent" type="application/atom+xml">


<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<meta name="format-detection" content="telephone=no,email=no,adress=no" />


<meta name="robots" content="index,follow" />
<meta name="referrer" content="origin-when-cross-origin" />
<meta name="google-site-verification" content="google_site_verification_code" />
<meta name="msvalidate.01" content="bing_site_verification_code" />


<link rel="icon" href="https://peter-stoyanov.github.io/img/favicon.ico" />
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="apple-touch-icon" sizes="120x120" href="https://peter-stoyanov.github.io/img/avatar.jpg">


<link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400" rel="stylesheet">
<style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
<style amp-custom>/*! normalize.css v7.0.0 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}code,kbd,samp{font-family:monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}[hidden],template{display:none}@font-face{font-family:fe;font-weight:400;font-style:normal;src:url(/fonts/fe.eot);src:url(/fonts/fe.eot#iefix) format("embedded-opentype"),url(/fonts/fe.woff2) format("woff2"),url(/fonts/fe.woff) format("woff"),url(/fonts/fe.ttf) format("truetype"),url(/fonts/fe.svg#fe) format("svg")}.icon{font-family:fe;font-style:normal;speak:none;display:inline-block;text-decoration:inherit;width:1em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-menu:before{content:"\e802"}.icon-email:before{content:"\e804"}.icon-rss:before{content:"\e803"}.icon-github:before{content:"\f09b"}.icon-dribbble:before{content:"\f31b"}.icon-linkedin:before{content:"\f318"}.icon-twitter:before{content:"\f309"}.icon-facebook:before{content:"\f30c"}.icon-instagram:before{content:"\f16d"}.icon-youtube:before{content:"\f16a"}.icon-google:before{content:"\f30f"}.icon-clock:before{content:"\e800"}.share{font-family:fe;font-weight:400;margin-left:.2rem;display:inline-block;text-align:center;border:none;outline:none;color:#fff;width:30px;height:30px;border-radius:50%}.share-twitter{background-color:#55acee}.share-twitter:before{content:"\f309"}.share-facebook{background-color:#3b5998}.share-facebook:before{content:"\f30c"}.share-google{background-color:#dd4b39}.share-google:before{content:"\f30f"}body{font-size:18px;font-weight:300;line-height:1.618;font-family:Roboto,sans-serif;color:#777;background:#fff;text-rendering:optimizeLegibility;-webkit-overflow-scrolling:touch}a{color:#3f9adc;text-decoration:none;font-weight:600}a:focus,a:hover{opacity:.7;outline:none}amp-img{margin:0 auto;box-shadow:2px 20px 40px 10px rgba(0,0,0,.15)}button:hover{cursor:pointer}.main{margin-left:20rem;padding:1rem 2rem;max-width:100%;min-height:100vh;box-sizing:border-box}@media screen and (max-width:1440px){.main{width:calc(100% - 20rem)}}@media (min-width:800px) and (max-width:960px){.main{margin-left:15rem;width:calc(100% - 15rem)}}@media screen and (max-width:800px){.main{margin-left:0;padding:0 1rem 1rem;width:100%;min-height:0;border-left:none;border-right:none;border-top:1px solid #ddd;border-bottom:1px solid #ddd}}.footer{display:none}@media screen and (max-width:800px){.footer{display:block;padding:1rem;font-size:.8rem;text-align:center;font-family:Roboto Mono,Menlo,Monaco,Consolas,Courier New,monospace}}.header{position:fixed;left:0;top:0;bottom:0;width:20rem;padding:1rem;box-sizing:border-box;text-align:center;background-color:rgba(106,172,14,.9)}@media screen and (max-width:800px){.header{width:100%;position:relative}}@media (min-width:800px) and (max-width:960px){.header{width:15rem}}.logo{margin-top:3rem;border-radius:20%;border:4px solid #fff;transition:all .5s ease-out}.logo:hover{border-radius:50%;box-shadow:0 1px 4px rgba(0,0,0,.3)}@media screen and (max-width:800px){.logo{position:absolute;top:1rem;left:1rem;width:2rem;height:2rem;margin-top:0;border:2px solid #fff}}.title{font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:600;margin:1rem auto}@media screen and (max-width:800px){.title{margin:0 auto}}.subtitle,.title a{color:#fff}.subtitle{margin-bottom:1rem;opacity:.8}.menu{display:none}@media screen and (min-width:800px){.menu{display:block}}.menu-list{list-style:none;padding:0}.menu-item{padding:1rem 0}.menu-item a{font-weight:100;opacity:.8;color:#fff}.menu-item a:focus,.menu-item a:hover{opacity:1}.menu-item.is-active a{color:#444;opacity:1;font-weight:700}.menu-toggle{border:none;outline:none;font-size:2rem;background-color:transparent;color:#fff;position:absolute;top:1rem;right:1rem}@media screen and (min-width:800px){.menu-toggle{display:none}}.sidebar{background-color:#fff;width:100vw}@media screen and (min-width:640px){.sidebar{width:50vw}}.sidebar-list{list-style:none;padding:0;margin:0}.sidebar-menu{text-align:right;padding:16px}.sidebar-item{font-size:2rem;padding:30px 35px 30px 25px;border-top:1px solid #ddd}.sidebar-item:hover{background-color:#f2f2f2}.sidebar-icon{border:none;outline:none;background-color:transparent;font-family:Roboto,sans-serif;font-weight:100;font-size:2rem}.sidebar-link{color:#000;font-weight:100}.social-list{margin:0;padding:0;list-style:none}@media screen and (min-width:800px){.social-list{position:absolute;bottom:10px;left:0;right:0}}.social-item{display:inline-block;margin:0 .2rem}.social-item a{color:#fff;font-weight:400}.entry-list{background-color:#f2f2f2}@media screen and (max-width:800px){.entry-list{padding-top:30px}}.entry-single{line-height:1.8;margin-bottom:22px;background-color:#fff;box-shadow:0 0 2px 0 rgba(137,146,177,.15),0 3px 10px 0 rgba(137,146,177,.1);border-radius:5px}.entry-single:hover{box-shadow:0 1px 15px 0 rgba(137,146,177,.15),0 10px 20px 0 rgba(137,146,177,.15)}.entry-cover{max-width:100%;border-radius:5px 5px 0 0;-o-object-fit:cover;object-fit:cover;box-shadow:none}.entry-title{margin:0;padding:20px 30px 0}.entry-link{font-size:1.5rem;font-weight:600;color:#262626}.entry-summary{padding:0 30px;text-align:justify;max-height:4rem;overflow:hidden}.entry-footer{margin:0 30px;padding:10px 0;border-top:1px solid #ddd;display:flex;justify-content:space-between}.entry-meta{margin:0;font-size:.8rem;letter-spacing:1px;text-transform:uppercase}.entry-time{color:#444}.entry-time:after{content:"";border-right:1px solid #ddd;margin:0 8px 0 10px}.pagination{display:flex;justify-content:flex-start}.pagination-btn{color:#777;padding:.8rem;background-color:#fff;border:1px solid #ddd;font-size:.8rem;text-transform:uppercase;border-radius:5px}.pagination-btn:focus,.pagination-btn:hover{color:#fff;background-color:#6aac0e;border-color:#6aac0e}.pagination-next{margin-left:auto}.post-header:after{display:block;content:"";border-bottom-width:3px;border-bottom-style:solid;width:60px;padding-top:10px;border-bottom-color:#6aac0e}.post-title{font-size:2rem;color:#262626;line-height:1.5;margin-top:1.5rem;margin-bottom:.5rem}.post-footer{margin:1rem 0;line-height:1.8}.post-tags{margin-top:0;margin-bottom:1rem;padding-left:0}.post-tag{display:inline-block;margin:0 .5rem 0 0;border-radius:3px;padding:5px 10px;background:#f2f2f2;font-size:.8rem}.post-tag:hover{background:#ddd;box-shadow:0 1px 15px 0 rgba(137,146,177,.15),0 10px 20px 0 rgba(137,146,177,.15)}.post-content{line-height:1.8}.post-content h1,.post-content h2,.post-content h3,.post-content h4,.post-content h5,.post-content h6{color:#6cb505;font-weight:700;line-height:1.125}.post-content h1{margin-top:2rem;margin-bottom:1rem;font-size:2rem}.post-content h2{margin-top:1.75rem;margin-bottom:.75rem;font-size:1.5rem}.post-content h3{margin-top:1.5rem;margin-bottom:.5rem;font-size:1.25rem}.post-content h4{margin-top:1.25rem;margin-bottom:.25rem;font-size:1rem}.post-content h5,.post-content h6{margin-top:1rem;margin-bottom:0;font-size:.8rem}.post-content li+li{margin-top:.5rem}.post-content em{color:#777;font-style:italic}.post-content strong{color:#444}.post-content del{color:#777;text-decoration:line-through}.post-content ins{color:#444;text-decoration:underline}.post-content hr{position:relative;margin:2rem auto;border-top:1px dashed #ddd;border-bottom:none}.post-content hr:before{content:"sep line";position:absolute;top:-12px;left:calc(50% - 40px);padding:0 .5rem;background-color:#fff;color:#ddd;font-size:.8rem;font-family:Roboto Mono,Menlo,Monaco,Consolas,Courier New,monospace}.post-content p{margin-top:1.5rem;margin-bottom:1.5rem;text-align:justify}.post-content blockquote{background-color:#f2f2f2;border-left:5px solid #ddd;padding:.5rem 1rem;margin:2rem 0}.post-content blockquote p{margin-top:.5rem;margin-bottom:.5rem}.post-content blockquote cite{margin-top:1.5rem;color:#777;font-size:.9rem}.post-content code,.post-content tt{padding:0;padding-top:.2em;padding-bottom:.2em;margin:0;font-size:.9em;background-color:#ddd;font-family:Roboto Mono,Menlo,Monaco,Consolas,Courier New,monospace}.post-content code:after,.post-content code:before,.post-content tt:after,.post-content tt:before{letter-spacing:-.2em;content:"\00a0"}.post-content kbd{display:inline-block;padding:.25em;background-color:#f2f2f2;border:1px solid #ddd;border-bottom-color:#ddd;border-radius:3px;box-shadow:inset 0 -1px 0 rgba(0,0,0,.05);font-size:.8em;line-height:1.25;font-family:Roboto Mono,Menlo,Monaco,Consolas,Courier New,monospace;color:#777}.post-content pre{margin:2rem auto;padding:1rem;overflow-x:auto;border-radius:3px;font-size:.9rem;line-height:1.618;white-space:pre;word-wrap:normal;word-break:normal;background:#ddd;color:#777}.post-content pre code{font-size:.9rem;background-color:transparent}.post-content pre code:after,.post-content pre code:before{content:none}.post-content sub,.post-content sup{font-size:.8rem}.post-content sub a,.post-content sub a:focus,.post-content sub a:hover,.post-content sup a,.post-content sup a:focus,.post-content sup a:hover{border-bottom:none}.post-content ol{margin-left:0;margin-top:2rem;margin-bottom:2rem;padding-left:1.5rem;list-style:decimal outside}.post-content ol ol{margin-top:.5rem;margin-bottom:.5rem;list-style:lower-roman outside}.post-content ol ul{margin-top:.5rem;margin-bottom:.5rem;list-style:disc outside}.post-content ul{margin-left:0;margin-top:2rem;margin-bottom:2rem;padding-left:1.5rem;list-style:disc outside}.post-content ul ul{margin-top:.5rem;margin-bottom:.5rem;list-style:circle outside}.post-content ul ol{margin-top:.5rem;margin-bottom:.5rem;list-style:decimal outside}.post-content dl{margin-top:2rem;margin-bottom:2rem}.post-content dl dt{color:#6aac0e;margin-top:1rem}.post-content dl dt:after{content:":"}.post-content dl dd{text-indent:2rem;margin-left:0;margin-top:.25rem}.post-content figure{display:block;margin:2rem auto}.post-content figure img{max-width:100%;box-shadow:2px 20px 40px 10px rgba(0,0,0,.15)}@media screen and (max-width:800px){.post-content figure img{box-shadow:none}}.post-content figure figcaption h4{color:#ddd;font-size:.9rem;text-align:center}table{background-color:#f2f2f2;color:#444;margin:2rem auto;width:100%;border-collapse:collapse;border-radius:5px}table td,table th{border:1px solid #ddd;border-width:0 0 1px;padding:.5em .75em;vertical-align:center}table th{color:#444}table tr:hover{background-color:#ddd}table thead td,table thead th{border-width:0 0 2px;color:#777}table tfoot td,table tfoot th{border-width:2px 0 0;color:#777}table tbody tr:last-child td,table tbody tr:last-child th{border-bottom-width:0}table tr:first-child th:first-child{border-top-left-radius:5px}table tr:first-child th:last-child{border-top-right-radius:5px}table tr:last-child td:first-child{border-bottom-left-radius:5px}table tr:last-child td:last-child{border-bottom-right-radius:5px}.not-found{margin:5rem auto 0;font-family:Roboto Mono,Menlo,Monaco,Consolas,Courier New,monospace;text-align:center}.error-emoji{color:#444;font-size:3rem}.error-text{font-size:1.25rem}.error-link{margin-top:2rem;font-size:1rem;color:#6aac0e}</style>

  </head>
  <body>
    <amp-sidebar id="sidebar" class="sidebar" layout="nodisplay" side="right">
  <ul class="sidebar-list">
    <li class="sidebar-menu"><button class="sidebar-icon" on="tap:sidebar.close">X</button></li>
    
    
    
    
  </ul>
</amp-sidebar>

    
  <header class="header">
  <amp-img alt="coreComponent"
    width="128px"
    height="128px"
    class="logo"
    src="https://peter-stoyanov.github.io/images/octocat.png"
    sizes="(max-width: 800px) 36px, 128px">
  </amp-img>
  
    <h2 class="title"><a href="https://peter-stoyanov.github.io/" title="coreComponent">coreComponent</a></h2>
  
  <p class="subtitle">A blog about software and tech</p>
  <button class="menu-toggle" type="button" on="tap:sidebar.open">
    <span class="icon icon-menu"></span>
  </button>

  
  <nav class="menu">
    <ul class="menu-list">
      
      
      
      
    </ul>
  </nav>

  <ul class="social-list">
  
  <li class="social-item">
    <a href="mailto:pesho.stoyanov@gmail.com" title="Email"><span class="icon icon-email"></span></a>
  </li>

  
  <li class="social-item">
    <a href="//github.com/peter-stoyanov" title="GitHub"><span class="icon icon-github"></span></a>
  </li>

  

  <li class="social-item">
    <a href="//www.linkedin.com/in/peshostoyanov" title="Linkedin"><span class="icon icon-linkedin"></span></a>
  </li>

  

  

  

  

  

  <li class="social-item">
    <a href="https://peter-stoyanov.github.io/index.xml" title="RSS"><span class="icon icon-rss"></span></a>
  </li>
</ul>

</header>

  <section class="main post-detail">
    <header class="post-header">
      <h1 class="post-title">Building TypeScript Projects with Bazel</h1>
      <p class="entry-meta"><span class="entry-time">Nov 19, 2018</span> 9 min read</p>
    </header>
    

    <article class="post-content">

<p>In this blog post, we&rsquo;ll make a brief introduction to what Bazel is and how we can build our TypeScript projects with it. If you&rsquo;re already familiar with the problems that Bazel solves, feel free to skip to the section &ldquo;Building TypeScript with Bazel.&rdquo; You can find the example from this blog post in <a href="https://github.com/mgechev/bazel-demo">my GitHub account</a>.</p>

<p><img src="https://peter-stoyanov.github.io/images/bazel-intro/banner.png" style="display: block; margin: auto"></p>

<h2 id="inside-google-s-ci">Inside Google&rsquo;s CI</h2>

<p>Google manages a massive amount of source code. There are dependencies between the individual projects, for example, the user interface of Google Cloud depends on Angular &amp; Angular Material, Angular Material depends on Angular, which depends on TypeScript.</p>

<p>The projects in Google use a single version for the individual libraries in the organization (including the third-party ones.) This simplifies the dependency management in the company dramatically. Another huge bonus of this convention is that an update of a library affects all the dependent projects. This way everyone can take advantage of the latest security fixes, performance improvements, and bug fixes. Following this process means that when Microsoft releases a new version of TypeScript, it gets synced inside of Google as soon as possible so that all the projects can take advantage of it. As you can imagine, changes in the type system of TypeScript may break a lot of code!</p>

<p>To verify that nothing broke after a dependency update, <strong>the internal CI rebuilds all the dependent projects and executes their tests</strong>. Having millions of lines of TypeScript and hundreds of thousands of TypeScript files, this process may take a while if not done right!</p>

<p>Often projects depend on other projects. For example, Google Cloud depends on its UI and back-end services. When we update TypeScript, we don&rsquo;t want to rebuild the back-end services if they don&rsquo;t rely on the language.</p>

<h2 id="what-s-bazel">What&rsquo;s Bazel</h2>

<p>Google open sourced the software responsible for building most of our projects under the name <a href="https://bazel.build">Bazel</a>. Bazel is a powerful tool which can keep track of the dependencies between different <strong>packages and build targets</strong>. For simplicity, we can think of a build target as a build rule - for example, “build a TypeScript library”; a package, on the other hand, is a directory with the files inside of it and specification of the dependencies among them. In the Google Cloud example above, Bazel will come up with a dependency graph similar to the one below:</p>

<p><img src="https://peter-stoyanov.github.io/images/bazel-intro/deps.svg" style="display: block; margin: auto"></p>

<p>For simplicity, we can map the boxes from the diagram to build targets. When the output of a given target changes, Bazel will calculate which other targets depend on it directly or transitively and rebuild them. In the example above, if TypeScript changes, Bazel will rebuild Angular, Angular Material, Google Cloud&rsquo;s UI but it&rsquo;ll leave the back-end services untouched.</p>

<p>Some of the cool features of Bazel are:</p>

<ol>
<li>It has a smart algorithm for determining the build dependencies</li>
<li>Bazel is independent of the tech stack. You can build anything you want with it using the same interface. For example, there are plugins for Java, Go, TypeScript, JavaScript, and more!</li>
</ol>

<p>Let us take a look at the first point. Based on the dependency graph of a project, Bazel determines which targets it can build in parallel. Such a feature is only possible because the individual units have well-defined inputs and outputs, and they don&rsquo;t produce side effects. To some extent, we can think of them as &ldquo;pure functions.&rdquo; One of the benefits of such a computational model is that it&rsquo;s straightforward to optimize the calculations using parallelism and caching. That&rsquo;s true for Bazel as well. It can cache the produced outputs from the individual build tasks anywhere, including in the cloud.</p>

<p>Why does the cloud cache matter? If Bazel has built a target and cached it in the cloud, anyone can reuse it without building it from scratch! If you&rsquo;re a large organization, this is quite attractive, but even small teams can take advantage of such a feature. Bazel is not coupled to any particular cloud platform, which means that you can take advantage of the remote build execution and caching in Google Cloud, Azure, AWS, or your on-premise infrastructure.</p>

<p>Anyway, enough abstract talking. Let&rsquo;s look at a specific example!</p>

<h2 id="building-typescript-with-bazel">Building TypeScript with Bazel</h2>

<p>For this example, we&rsquo;ll build a small TypeScript project to an ES5 JavaScript bundle. The project is a little programming language which has the following modules:</p>

<ul>
<li>Lexer - accepts a string and returns an array of tokens</li>
<li>Parser - accepts an array of tokens and returns an abstract syntax tree (AST)</li>
<li>Interpreter - accepts an AST and evaluates it</li>
<li>Application - wires everything together - passes the program to the lexer, feeds the parser with the lexer&rsquo;s output, and the interpreter with the produced AST</li>
</ul>

<p>You can find the example <a href="https://github.com/mgechev/bazel-demo">here</a>. The directory structure is as follows:</p>

<pre><code>.
├── BUILD
├── WORKSPACE
├── interpreter
│   ├── BUILD
│   └── index.ts
├── lexer
│   ├── BUILD
│   └── index.ts
├── package.json
├── parser
│   ├── BUILD
│   └── index.ts
├── test.ts
└── tsconfig.json
</code></pre>

<p>The tree above looks like a standard TypeScript project - we have a bunch of <code>*.ts</code> files, <code>package.json</code>, and <code>tsconfig.json</code>. We also have <code>WORKSPACE</code> and four <code>BUILD</code> files. That&rsquo;s what this blog post is all about.</p>

<p>First, let us look at <code>package.json</code>:</p>

<pre><code class="language-json">{
  &quot;name&quot;: &quot;bazel-demo&quot;,
  &quot;license&quot;: &quot;MIT&quot;,
  &quot;devDependencies&quot;: {
    &quot;@bazel/bazel&quot;: &quot;^0.19.1&quot;,
    &quot;@bazel/typescript&quot;: &quot;0.21.0&quot;,
    &quot;typescript&quot;: &quot;^3.1.6&quot;
  }
}
</code></pre>

<h2 id="configuring-the-workspace">Configuring the Workspace</h2>

<p>Our project depends on the npm packages TypeScript, Bazel, and its TypeScript rules. So far nothing new. Let us now dive into the <code>WORKSPACE</code> configuration file:</p>

<pre><code class="language-python">workspace(name = 'lang')

http_archive(
    name = &quot;build_bazel_rules_typescript&quot;,
    url = &quot;https://github.com/bazelbuild/rules_typescript/archive/0.21.0.zip&quot;,
    strip_prefix = &quot;rules_typescript-0.21.0&quot;,
)

# Fetch our Bazel dependencies that aren't distributed on npm
load(&quot;@build_bazel_rules_typescript//:package.bzl&quot;, &quot;rules_typescript_dependencies&quot;)
rules_typescript_dependencies()

# Setup TypeScript toolchain
load(&quot;@build_bazel_rules_typescript//:defs.bzl&quot;, &quot;ts_setup_workspace&quot;)
ts_setup_workspace()

# Setup the Node.js toolchain
load(&quot;@build_bazel_rules_nodejs//:defs.bzl&quot;, &quot;node_repositories&quot;, &quot;yarn_install&quot;)
node_repositories()

# Setup Bazel managed npm dependencies with the `yarn_install` rule.
yarn_install(
  name = &quot;npm&quot;,
  package_json = &quot;//:package.json&quot;,
  yarn_lock = &quot;//:yarn.lock&quot;,
)
</code></pre>

<div style="padding: 20px; border-radius: 5px; background-color: #fff4da">
Keep in mind that this is a low-level introduction. In reality, it's very likely that you never have to manage your Bazel configuration by yourself.
</div>

<p>The file above uses a language called <a href="https://github.com/bazelbuild/starlark">Starlark</a>, you can think of it as a subset of Python. Here&rsquo;s what we declare:</p>

<ol>
<li>The name of the workspace is <code>lang</code></li>
<li>We use the Bazel&rsquo;s TypeScript rules. Keep in mind that they have to be the same version as the ones declared in <code>package.json</code></li>
<li>As the next step, we fetch Bazel’s dependencies from <code>build_bazel_rules_typescript</code></li>
<li>We set up the TypeScript workspace</li>
<li>We set up the Bazel&rsquo;s Node.js toolchain. It consists of a bunch of tools developed by the Bazel team so that we can use Node.js with Bazel</li>
<li>Finally, we declare a rule which lets Bazel manage our npm dependencies</li>
</ol>

<p>Don&rsquo;t worry if it the snippet above doesn&rsquo;t look obvious. You can think of the <code>load</code> invocations as a <code>require</code> in Node.js with the difference that Bazel can fetch the dependencies from the network.</p>

<h2 id="configuring-the-targets">Configuring the Targets</h2>

<p>We&rsquo;re going to go on a very granular level. We can directly map the individual modules of the project to separate Bazel packages, and in each package, we’ll define a target. As we mentioned above, we can think of the packages as directories and their corresponding files and the targets as build rules.</p>

<p>Each directory has a <code>BUILD</code> file (or <code>BUILD.bzl</code> if you prefer). Let us take a look at the <code>BUILD</code> file in the root of the project:</p>

<pre><code class="language-python">package(default_visibility = [&quot;//visibility:public&quot;])

load(&quot;@build_bazel_rules_typescript//:defs.bzl&quot;, &quot;ts_library&quot;)

ts_library(
  name = &quot;app&quot;,
  srcs = [&quot;test.ts&quot;],
  deps = [&quot;//lexer&quot;, &quot;//parser&quot;, &quot;//interpreter&quot;],
)

load(&quot;@build_bazel_rules_nodejs//:defs.bzl&quot;, &quot;rollup_bundle&quot;)

rollup_bundle(
  name = &quot;bundle&quot;,
  entry_point = &quot;test.js&quot;,
  deps = [&quot;:app&quot;],
)
</code></pre>

<p>Above we first set the visibility of this package to the public, and after that, load two Bazel rules:</p>

<ul>
<li><code>ts_library</code> - we use it to build the TypeScript files</li>
<li><code>rollup_bundle</code> - internally invokes Rollup.js to combine the individual modules into a single file</li>
</ul>

<p>The <code>ts_library</code> rule we use to build the <code>app</code> target. The <code>app</code> target represents our programming language which wires the individual modules together. It depends on the <code>lexer</code>, <code>parser</code>, and the <code>interpreter</code>. In the directories of these modules, we have <code>BUILD</code> files with similar content. For example, the <code>parser</code>&rsquo;s content looks as follows:</p>

<pre><code class="language-python">package(default_visibility = [&quot;//visibility:public&quot;])

load(&quot;@build_bazel_rules_typescript//:defs.bzl&quot;, &quot;ts_library&quot;)

ts_library(
    name = &quot;parser&quot;,
    srcs = glob([&quot;*.ts&quot;]),
    deps = [&quot;//lexer&quot;],
)
</code></pre>

<p>This time we use a <code>glob</code> to indicate the source files. Also, notice that the parser depends only on the lexer.</p>

<p>Having a lot of targets with many dependencies may get confusing. A neat feature of Bazel is that the dependency graph is statically analyzable! We can directly query the dependency graph using Bazel&rsquo;s query language. Let us go one step further and directly visualize it!</p>

<p>First, run <code>yarn</code> to install all the dependencies from <code>package.json</code> so that we can get the Bazel’s binary:</p>

<pre><code class="language-bash">yarn
</code></pre>

<p>Now run (you may need to install <code>graphviz</code> before that):</p>

<pre><code class="language-bash">./node_modules/.bin/bazel query --output=graph ... | dot -Tpng &gt; graph.png
</code></pre>

<p>The output of the command looks as follows:</p>

<p><img src="https://peter-stoyanov.github.io/images/bazel-intro/graph.png" style="display: block; margin: auto"></p>

<p>We can see the dependencies between the individual targets - <code>:bundle</code> depends on the <code>:app</code> target, which depends on the <code>:interpreter</code>, <code>:parser</code>, and the <code>:lexer</code>. The output <code>//parser:parser</code> means “the target <code>:parser</code> from the package <code>//parser</code>.</p>

<p>Now we&rsquo;re ready to build the project! Run:</p>

<pre><code class="language-bash">./node_modules/.bin/bazel build :bundle
</code></pre>

<p>The first invocation of the command above may take some time because Bazel will load the dependencies of the workspace when it needs them. Each subsequent invocation should be instantaneous.</p>

<p>Now let us verify that everything works as expected by executing the produced bundle:</p>

<pre><code class="language-bash">node bazel-bin/bundle.js
43
</code></pre>

<div style="padding: 20px; border-radius: 5px; background-color: #fff4da">
Once you build a target Bazel will create a bunch of symlinks in your workspace. They contain different build artifacts. If you prefer to get rid of them, you can configure Bazel with <code>bazel.rc</code>.
</div>

<h2 id="watch-mode">Watch Mode</h2>

<p>How about watching the files of the project and rebuilding on change? For the purpose, we need to install <code>@bazel/ibazel</code> and run:</p>

<pre><code class="language-bash"># Don’t forget yarn add -D @bazel/ibazel
./node_modules/.bin/ibazel build :app
</code></pre>

<p>With both <code>ibazel</code> and <code>bazel</code> we&rsquo;ll rebuild given target only when any of its direct or transitive dependencies change.</p>

<div style="padding: 20px; border-radius: 5px; background-color: #fff4da">
Notice that in the <code>ibazel</code> example above we build the <code>:app</code> target. This is because we wouldn’t be able to demonstrate incrementality with the <code>:bundle</code> target since at the time of writing the Rollup.js rule for Bazel is still under active development.
</div>

<p>Let us now create some shortcuts so that we don&rsquo;t directly invoke <code>./node_modules/.bin/bazel</code> or <code>./node_modules/.bin/ibazel</code> every time:</p>

<p>Update <code>package.json</code> and add the following two scripts:</p>

<pre><code class="language-json">{
  &quot;name&quot;: &quot;bazel-demo&quot;,
  &quot;license&quot;: &quot;MIT&quot;,
  &quot;scripts&quot;: {
    &quot;build&quot;: &quot;bazel build :bundle&quot;,
    &quot;watch&quot;: &quot;ibazel build :app&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;@bazel/bazel&quot;: &quot;^0.19.1&quot;,
    &quot;@bazel/typescript&quot;: &quot;0.21.0&quot;,
    &quot;typescript&quot;: &quot;^3.1.6&quot;
  }
}
</code></pre>

<p>Now with <code>yarn build</code> we&rsquo;ll rebuild the project and with <code>yarn watch</code> we&rsquo;ll watch and rebuild the targets on change.</p>

<h2 id="conclusion">Conclusion</h2>

<p>In this blog post, we looked at Google&rsquo;s build system Bazel. We explained some of the problems that Bazel solves to provide fast and scalable build solution.</p>

<p>In the second part of the post, we looked at a sample build setup for a small TypeScript project, where we compile a bunch of files and bundle them with Rollup.js. In the process, we explained what a workspace, a build target, package, and how we can configure them.</p>

<p>At this point, we saw one of the core strengths of Bazel - static dependency graph which allows neat optimizations such as caching and parallelism. Be tuned for the next post in which we&rsquo;ll take a closer look at the performance implications.</p>
</article>
    <footer class="post-footer">
      
      <ul class="post-tags">
        
          <li class="post-tag"><a href="https://peter-stoyanov.github.io/tags/bazel"><span class="tag">Bazel</span></a></li>
        
          <li class="post-tag"><a href="https://peter-stoyanov.github.io/tags/build"><span class="tag">Build</span></a></li>
        
          <li class="post-tag"><a href="https://peter-stoyanov.github.io/tags/typescript"><span class="tag">TypeScript</span></a></li>
        
      </ul>
      
      <div class="sharing">
        <a class="share share-facebook" target="_blank" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fpeter-stoyanov.github.io%2f2018%2f11%2f19%2fintroduction-bazel-typescript-tutorial%2f" title="Share on Facebook"></a>
        <a class="share share-twitter" target="_blank" href="https://twitter.com/intent/tweet/?text=Building%20TypeScript%20Projects%20with%20Bazel&amp;url=https%3a%2f%2fpeter-stoyanov.github.io%2f2018%2f11%2f19%2fintroduction-bazel-typescript-tutorial%2f" title="Share on Twitter"></a>
        <a class="share share-google" target="_blank" href="https://plus.google.com/share?url=Building%20TypeScript%20Projects%20with%20Bazel&amp;url=https%3a%2f%2fpeter-stoyanov.github.io%2f2018%2f11%2f19%2fintroduction-bazel-typescript-tutorial%2f" title="Share on Google+"></a>
      </div>
    </footer>
  </section>
  <footer class="footer">
  <p>Copyright © 2018 coreComponent</p>
  <p>Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> with theme <a href="https://github.com/huyb1991/hugo-lamp" title="Hugo LAMP" target="_blank">LAMP</a>.</p>
</footer>





<amp-analytics type=googleanalytics>
  <script type=application/json>
    {
      "vars": { "account": "UA-130004310-1" },
      "triggers": { "trackPageview": { "on": "visible", "request": "pageview" } }
    }
  </script>
</amp-analytics>



  </body>
</html>
